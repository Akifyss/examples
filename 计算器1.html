<script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>

<div id="container" class="container" style="left:50px; top: 50px">
    <span class="iconify drag-icon" data-icon="grommet-icons:drag"
        style="position: absolute; left: -16px; top: -16px; cursor: move;"></span>





        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>计算器</title>
            <script src="https://cdn.tailwindcss.com"></script>
            <style>
                :root {
                    --defaultWidth: 300px;
                    --defaultHeight: 400px;
                    --uiWidth: var(--defaultWidth);
                    --uiHeight: var(--defaultHeight);
                }
                #calculator {
                    width: var(--uiWidth);
                    height: var(--uiHeight);
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    padding: 0;
                    margin: 0 auto;
                }
                #display {
                    height: 25%;
                    background-color: #f3f4f6;
                    display: flex;
                    align-items: center;
                    justify-content: flex-end;
                    padding: 10px;
                    font-size: 2em;
                    border: none;
                    color: #1f2937;
                }
                #keyboard {
                    height: 75%;
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 1px;
                }
                .key {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #e5e7eb;
                    color: #1f2937;
                    font-size: 1.5em;
                    user-select: none;
                    cursor: pointer;
                }
                .key:active {
                    background-color: #d1d5db;
                }
            </style>
        </head>
        <body>
            <div id="calculator">
                <div id="display">0</div>
                <div id="keyboard">
                    <div id="keyC" class="key">C</div>
                    <div id="keyDel" class="key">←</div>
                    <div id="keyPercent" class="key">%</div>
                    <div id="keyDivide" class="key">÷</div>
                    <div id="key7" class="key">7</div>
                    <div id="key8" class="key">8</div>
                    <div id="key9" class="key">9</div>
                    <div id="keyMultiply" class="key">×</div>
                    <div id="key4" class="key">4</div>
                    <div id="key5" class="key">5</div>
                    <div id="key6" class="key">6</div>
                    <div id="keyMinus" class="key">-</div>
                    <div id="key1" class="key">1</div>
                    <div id="key2" class="key">2</div>
                    <div id="key3" class="key">3</div>
                    <div id="keyAdd" class="key">+</div>
                    <div id="key0" class="key" style="grid-column: span 2;">0</div>
                    <div id="keyDot" class="key">.</div>
                    <div id="keyEquals" class="key">=</div>
                </div>
            </div>
            <script>
                const display = document.getElementById('display');
                let equation = '';
        
                document.querySelectorAll('.key').forEach(key => {
                    key.addEventListener('click', () => {
                        const keyValue = key.textContent;
        
                        if (keyValue === 'C') {
                            equation = '';
                            display.textContent = '0';
                        } else if (keyValue === '←') {
                            equation = equation.slice(0, -1);
                            display.textContent = equation || '0';
                        } else if (keyValue === '=') {
                            try {
                                equation = eval(equation.replace(/÷/g, '/').replace(/×/g, '*')).toString();
                                display.textContent = equation;
                            } catch (error) {
                                display.textContent = 'Error';
                                equation = '';
                            }
                        } else {
                            equation += keyValue;
                            display.textContent = equation;
                        }
                    });
                });
            </script>
        </body>
        </html>
</div>

<style>
    .container {
        border: 2px solid #3786f4;
        box-sizing: content-box;
        position: absolute;
        z-index: 1000;
    }

    .drag-icon {
        z-index: 1000;
    }
</style>

<script>
    fetch('计算器1.json')
        .then(response => response.json())
        .then(data => {
            const defaultWidth = data.defaultWidth;
            const defaultHeight = data.defaultHeight;
            const container = document.getElementById('container');
            container.style.width = defaultWidth;
            container.style.height = defaultHeight;
            document.documentElement.style.setProperty('--defaultWidth', defaultWidth);
            document.documentElement.style.setProperty('--defaultHeight', defaultHeight);
        });

    let MARGIN = 5;
    var container = document.getElementById('container');
    var dragIcon = document.querySelector('.drag-icon');
    var isDragging = false;
    let containerWidth, containerHeight;


    dragIcon.addEventListener("mousedown", function (event) {
        isDragging = true;
        var startX = event.clientX;
        var startY = event.clientY;
        var origX = container.offsetLeft;
        var origY = container.offsetTop;
        var deltaX = startX - origX;
        var deltaY = startY - origY;

        function onMove(event) {
            if (isDragging) {
                var newX = event.clientX - deltaX;
                var newY = event.clientY - deltaY;
                container.style.left = newX + 'px';
                container.style.top = newY + 'px';
            }
        }

        function onUp() {
            isDragging = false;
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('mouseup', onUp);
        }

        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
        event.preventDefault(); // 防止默认事件发生
    });

    container.addEventListener("mousedown", function (event) {
        if (event.target.id === 'container') {
            onMouseDown(event);
        }
    });
    container.addEventListener("mousemove", function (event) {
        if (event.target.id === 'container') {
            onMouseMove(event);
        }
    });

    function onMouseDown(event) {
        var container = event.target;
        var b = container.getBoundingClientRect();
        var x = event.clientX - b.left;
        var y = event.clientY - b.top;
        let initialClientX = event.clientX;
        let initialClientY = event.clientY;
        var onTopEdge = y < MARGIN;
        var onLeftEdge = x < MARGIN;
        var onRightEdge = x >= b.width - MARGIN;
        var onBottomEdge = y >= b.height - MARGIN;
        var isResizing = onRightEdge || onLeftEdge || onTopEdge || onBottomEdge;

        if (isResizing) {
            function onMouseMoveResize(event) {
                if (onRightEdge) {
                    container.style.width = (event.clientX - b.left) + 'px';
                }
                if (onBottomEdge) {
                    container.style.height = (event.clientY - b.top) + 'px';
                }
                if (onLeftEdge) {
                    container.style.left = event.clientX + 'px';
                    container.style.width = (initialClientX - event.clientX + b.width) + 'px';
                }
                if (onTopEdge) {
                    container.style.top = event.clientY + 'px';
                    container.style.height = (initialClientY - event.clientY + b.height) + 'px';
                }
                containerWidth = container.style.width;
                containerHeight = container.style.height;
                document.documentElement.style.setProperty('--uiWidth', containerWidth);
                document.documentElement.style.setProperty('--uiHeight', containerHeight);
            }

            function onMouseUpResize() {
                document.removeEventListener('mousemove', onMouseMoveResize);
                document.removeEventListener('mouseup', onMouseUpResize);
            }

            document.addEventListener('mousemove', onMouseMoveResize);
            document.addEventListener('mouseup', onMouseUpResize);
        }
    }

    function onMouseMove(event) {
        var container = event.target;
        var b = container.getBoundingClientRect();
        var x = event.clientX - b.left;
        var y = event.clientY - b.top;
        var onTopEdge = y < MARGIN;
        var onLeftEdge = x < MARGIN;
        var onRightEdge = x >= b.width - MARGIN;
        var onBottomEdge = y >= b.height - MARGIN;

        if (onRightEdge && onBottomEdge || onLeftEdge && onTopEdge) {
            container.style.cursor = 'nwse-resize';
        } else if (onRightEdge && onTopEdge || onBottomEdge && onLeftEdge) {
            container.style.cursor = 'nesw-resize';
        } else if (onRightEdge || onLeftEdge) {
            container.style.cursor = 'ew-resize';
        } else if (onBottomEdge || onTopEdge) {
            container.style.cursor = 'ns-resize';
        } else {
            container.style.cursor = 'move';
        }
    }



</script>
<textarea id="selectedElementName" style="position: fixed; right: 16px; bottom: 16px; resize: all; width: calc(100% - 32px); height: 120px;"></textarea>
<script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const captureButton = document.createElement('button');
        captureButton.textContent = '捕获元素';
        captureButton.style.position = 'fixed';
        captureButton.style.right = '16px';
        captureButton.style.top = '16px';
        document.body.appendChild(captureButton);

        let selectedElements = []; // 存储选中的元素
        let lastHighlightedElement = null; // 存储上一个高亮的元素
        let isCapturing = false; // 标记是否处于捕获模式

        captureButton.addEventListener('click', function () {
            if (!isCapturing) {
                captureButton.textContent = '退出捕获';
                document.body.style.cursor = 'crosshair';
                document.addEventListener('mouseover', highlightElement);
                document.addEventListener('mouseout', removeHighlight);
                document.addEventListener('click', selectElement, true);
                isCapturing = true;
            } else {
                exitCaptureMode();
            }
        });

        function highlightElement(event) {
            if (event.target === captureButton) return; // 忽略按钮本身
            if (lastHighlightedElement) {
                removeHighlight({target: lastHighlightedElement});
            }
            event.target.style.outline = '2px solid magenta'; // 将颜色改为品红色
            lastHighlightedElement = event.target;
        }

        function removeHighlight(event) {
            if (!selectedElements.includes(event.target)) {
                event.target.style.outline = '';
            }
        }

        function selectElement(event) {
            if (event.target === captureButton) return; // 忽略按钮本身
            if (event.shiftKey) {
                const targetElement = event.target;
                if (!selectedElements.includes(targetElement)) {
                    targetElement.style.outline = '2px solid magenta'; // 将颜色改为品红色
                    selectedElements.push(targetElement);
                }
            } else {
                if (!selectedElements.includes(event.target)) {
                    selectedElements.forEach(element => element.style.outline = '');
                    selectedElements = [];
                    event.target.style.outline = '2px solid magenta'; // 将颜色改为品红色
                    selectedElements.push(event.target);
                }
            }
            updateSelectedElementsDisplay();
            event.preventDefault();
            event.stopPropagation();
        }

        function updateSelectedElementsDisplay() {
            const formattedElements = selectedElements.map(element => {
                const elementTagName = element.tagName.toLowerCase();
                const elementId = element.id ? ` id="${element.id}"` : '';
                const elementClasses = element.className ? ` class="${element.className}"` : '';
                return `<${elementTagName}${elementId}${elementClasses}></${elementTagName}>`;
            }).join('\n');

            document.getElementById('selectedElementName').value = formattedElements;
        }

        function exitCaptureMode() {
            captureButton.textContent = '捕获元素';
            document.body.style.cursor = '';
            document.removeEventListener('mouseover', highlightElement);
            document.removeEventListener('mouseout', removeHighlight);
            document.removeEventListener('click', selectElement, true);
            isCapturing = false;
            selectedElements.forEach(element => element.style.outline = ''); // 退出捕获后清除之前的被选中样式
            selectedElements = []; // 清空选中元素数组
        }
    });
</script>
